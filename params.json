{"name":"Thonda.github.com","tagline":"","body":"# STEP1 9.PHPからデータベースを操作してみる\r\n\r\n### 接続\r\n\r\nまずはPHPからデータベースに接続します。昔はmysql_connect関数を使っていましたが、最近はmysqliクラスを利用する方法が一般的です。\r\n```php\r\n<?php\r\n$mysqli = new mysqli('ホスト名', 'ユーザ名', 'パスワード', 'データベース名');\r\nif ($mysqli->connect_error){\r\n  print(\"接続失敗：\" . $mysqli->connect_error);\r\n  exit();\r\n}\r\n?>\r\n```\r\nホスト名はPHPを動かすサーバとデータベースを動かすサーバを分けない限りlocalhostです。初期設定ではユーザ名はroot、パスワードは無しになっています。\r\n\r\n### 実行\r\n\r\nコマンド（クエリ）を実行するにはmysqli::query関数を使用します。\r\n\r\nINSERTの例\r\n```php\r\n<?php\r\n$result = $mysqli->query(\"INSERT INTO datas (name, text) VALUES ('piyo', 'hogepiyo')\");\r\nif($result)\r\n  print(\"INSERT成功\");\r\nelse\r\n  print(\"INSERT失敗\");\r\n?>\r\n```\r\nこのような場合mysqli::query関数は成功したかどうかを返します。\r\n\r\nSELECTの例\r\n```php\r\n<?php\r\n$result = $mysqli->query(\"SELECT * FROM datas ORDER BY date DESC\");\r\nif($result){\r\n  while($row = $result->fetch_object()){\r\n    $name = htmlspecialchars($row->name);\r\n    $text = htmlspecialchars($row->text);\r\n    $date = htmlspecialchars($row->date);\r\n    print(\"$name : $text ($date)<br>\");\r\n  }\r\n}\r\n?>\r\n```\r\nこのような場合mysqli::query関数は結果オブジェクトを返します。fetch_object関数で1行ずつ取り出して表示します。\r\n\r\n今回はユーザーの入力を受け取っていないので使用しませんでしたが、ユーザーの入力をSQL文の一部に使用する場合は必ずmysqli::real_escape_string関数でエスケープするようにします。\r\n```php\r\n<?php\r\n$name = $mysqli->real_escape_string($_POST[\"name\"]);\r\n$text = $mysqli->real_escape_string($_POST[\"text\"]);\r\n$result = $mysqli->query(\"INSERT INTO datas (name, text) VALUES ('$name', '$text')\");\r\n?>\r\n```\r\n\r\n### 切断\r\n\r\nデータベースの操作が終わったら接続を切ります。\r\n```php\r\n<?php\r\n$mysqli->close();\r\n?>\r\n```","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}