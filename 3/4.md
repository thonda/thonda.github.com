---
layout: default
---
# STEP3-4.効率的な書き方、デバッグの仕方

プログラムが大規模になってくるとコードが複雑化し、プログラムの作成が非常に困難になります。前回から引き続き、プログラムを分かりやすく・読みやすく書く方法について考えます。

## コーディング規約

プログラムを書く際は一定の規則に従って書くことにより可読性が向上します。その規則のことをコーディング規約といいます。

### 見た目
以下のようなことを決めておくといいでしょう。また、IDEを使用すればある程度自動で統一されます。

* {}の間は適切にインデントする。
* {の位置を新しい行にするかしないか統一する。
* 演算子や識別子の間はスペースを空ける。

### 命名規則
変数やクラス名の付け方も決めておくといいでしょう。以下はよく使われる複数の単語からなる語の表し方です。

* キャメル記法：単語ごとに、1文字目を大文字にする記法
 * アッパーキャメルケース(UCC)の例：GetDatas
 * ローワーキャメルケース(LCC)の例：getDatas
* スネーク記法：単語の区切りをアンダースコア(_)で表す記法
 * 例：get_datas

CakePHPでは使用箇所に応じて上記3つの記法が混在して使用されています。

* クラス名はUCC、変数名・関数名はLCC、定数は全て大文字のスネーク記法とする。
* privateやprotectedなメソッドはアンダースコア(_)ではじめる。
* ファイル名はクラス名と同じにする。
* コントローラ名は複数形でUCCで最後にControllerを付ける。
 * 例：UserCommentsController
* モデル名は単数形でUCCに、データベース名は複数形でスネーク記法にする。
 * 例：モデル名 UserComment データベース名 user_comments
* ビューファイル名はスネーク記法にする。

## 構造

構造を考えてプログラムを書くことにより、どこでどの動作を行っているかが明確になる、変更が容易になる、バグが出たときの発見や修正が容易になるといったメリットがあります。具体的にはどうすればよいのでしょうか。

### 全体像を考えてからコーディングする
まずは仕様書を書くことが大切だということです。プログラム全体がどのようなものになるのかを考え、それぞれの機能を適切に部品に分割し、どのように連携するかを決めます。このように大まかに分割した後、それぞれの部品ごとに同じように適切な分割や設計を行っていきます。こうすることで同じ処理を何度も書く、途中で大きく書き直すなどの無駄な時間がなくなり、スムーズにコーディングすることができます。

### 各機能の独立性を高める
各機能の独立性を高めることによって、ある機能を変更したときやバグが発生したときに、他の機能への影響が最小限に抑えられます。これはオブジェクト指向と非常に親和性が高いです。

### シンプルに書く
機能を実装する際も、むやみに書き始めるのではなく効率的な方法を考えてから書き始めます。むやみに書くとデバッグ時間が長くなるため、結果的に時間がかかってしまいます。

## デバッグ
ここではCakePHPによるデバッグの仕方について説明します。

### スタックトレース
エラーが発生した際、下部に表示されているものです。これはエラーが発生した関数がどこから呼ばれたものかを段階的に全て表示しているもので、エラーの原因を特定するのに役に立ちます。エラーが発生していない箇所でもDebugger::trace()を呼び出すとスタックトレースを取得できます。

### ログ
エラーが発生した際、画面に表示するだけではなく/app/tmp/logs/error.logにも保存されています。エラー以外にもDebugger::log()にログ出力したい変数を渡すと/app/tmp/logs/debug.logに保存されます。もしくは$this->log('出力される内容', 'debug');とすることでもdebug.logを保存できます。

### debug関数
エラーが発生したら変数やオブジェクトの中身を見たくなるものです。debug関数に変数やオブジェクトを渡すと、debug関数が実行された場所とともに、渡された変数やオブジェクトの内容が表示されます。